<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SAUBER Weather</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary-color: #007AFF;
      --card-bg: rgba(255, 255, 255, 0.8);
      --card-border: rgba(255, 255, 255, 0.2);
      --text-primary: #1C1C1E;
      --text-secondary: #636366;
      --blur-effect: saturate(180%) blur(20px);
      --highlight-color: rgba(255, 255, 255, 0.4);
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(160deg, #E6F2FF 0%, #F0F5FF 100%);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }
    
    /* Солнечные блики */
    .sunlight {
      position: fixed;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at center, rgba(255,255,255,0.1) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
      transition: transform 0.1s linear;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      position: relative;
      z-index: 1;
    }
    
    /* Заголовок */
    .header {
      text-align: center;
      margin-bottom: 10px;
    }
    
    .header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      margin: 0;
      background: linear-gradient(45deg, #007AFF, #34C759);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Карта погоды */
    .weather-map-container {
      height: 250px;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--card-border);
      position: relative;
    }
    
    .weather-map {
      height: 100%;
      width: 100%;
    }
    
    .map-controls {
      position: absolute;
      bottom: 10px;
      left: 10px;
      z-index: 1000;
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }
    
    .map-layer-btn {
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 8px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    
    .map-layer-btn:hover {
      background: white;
      transform: translateY(-2px);
    }
    
    /* Прогноз по дням */
    .forecast-scroll {
      width: 100%;
      overflow-x: auto;
      padding-bottom: 10px;
      -webkit-overflow-scrolling: touch;
    }
    
    .forecast-days {
      display: flex;
      gap: 10px;
      width: max-content;
      padding: 5px;
    }
    
    .forecast-day {
      min-width: 70px;
      padding: 12px;
      border-radius: 14px;
      background: var(--card-bg);
      backdrop-filter: var(--blur-effect);
      -webkit-backdrop-filter: var(--blur-effect);
      border: 1px solid var(--card-border);
      box-shadow: 0 4px 16px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: all 0.3s ease;
    }
    
    .forecast-day:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    
    .forecast-dayname {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
    }
    
    .forecast-temp {
      font-size: 16px;
      font-weight: 500;
    }
    
    /* Текущая погода */
    .current-weather {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .weather-param {
      background: var(--card-bg);
      backdrop-filter: var(--blur-effect);
      -webkit-backdrop-filter: var(--blur-effect);
      border-radius: 14px;
      padding: 15px;
      border: 1px solid var(--card-border);
      box-shadow: 0 4px 16px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
    }
    
    .weather-param:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    
    .param-value {
      font-size: 20px;
      font-weight: 500;
      margin-bottom: 5px;
    }
    
    .param-label {
      font-size: 13px;
      color: var(--text-secondary);
    }
    
    /* Наш датчик */
    .sensor-data {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    
    .sensor-param {
      background: var(--card-bg);
      backdrop-filter: var(--blur-effect);
      -webkit-backdrop-filter: var(--blur-effect);
      border-radius: 14px;
      padding: 15px;
      border: 1px solid var(--card-border);
      box-shadow: 0 4px 16px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .sensor-param:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    
    .sensor-value {
      font-size: 20px;
      font-weight: 500;
      margin-bottom: 5px;
    }
    
    .sensor-label {
      font-size: 13px;
      color: var(--text-secondary);
    }
    
    /* Качество воздуха */
    .air-quality {
      margin-top: 10px;
    }
    
    .quality-item {
      margin-bottom: 12px;
    }
    
    .quality-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      border-radius: 14px;
      background: var(--card-bg);
      backdrop-filter: var(--blur-effect);
      -webkit-backdrop-filter: var(--blur-effect);
      border: 1px solid var(--card-border);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .quality-header:hover {
      background: rgba(255, 255, 255, 0.7);
    }
    
    .quality-indicator {
      height: 6px;
      border-radius: 3px;
      margin-top: 8px;
      background: linear-gradient(to right, #4CAF50, #FFEB3B, #F44336);
      transition: all 0.5s ease;
    }
    
    .quality-info {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      padding: 0 15px;
    }
    
    .quality-info.active {
      max-height: 200px;
      padding: 10px 15px;
    }
    
    .quality-info p {
      margin: 8px 0;
      font-size: 14px;
      line-height: 1.4;
      color: var(--text-secondary);
    }
    
    /* Компас */
    .compass-container {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .compass {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: var(--card-bg);
      backdrop-filter: var(--blur-effect);
      -webkit-backdrop-filter: var(--blur-effect);
      border: 1px solid var(--card-border);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .compass-arrow {
      width: 40px;
      height: 40px;
      background-color: #FF3B30;
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
      transform-origin: 50% 100%;
      transition: transform 0.1s ease;
    }
    
    .compass-labels {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
    }
    
    .compass-label {
      position: absolute;
      font-size: 12px;
      font-weight: bold;
    }
    
    /* Статус */
    .status {
      margin-top: 15px;
      padding: 12px;
      border-radius: 14px;
      text-align: center;
      font-size: 14px;
      background: var(--card-bg);
      backdrop-filter: var(--blur-effect);
      -webkit-backdrop-filter: var(--blur-effect);
      border: 1px solid var(--card-border);
    }
    
    .online {
      color: #34C759;
    }
    
    .offline {
      color: #FF3B30;
    }
    
    /* Анимации */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .card {
      animation: fadeIn 0.5s ease forwards;
    }
    
    /* Мобильная адаптация */
    @media (max-width: 500px) {
      .current-weather {
        grid-template-columns: 1fr;
      }
      
      .sensor-data {
        grid-template-columns: 1fr 1fr;
      }
      
      .weather-map-container {
        height: 200px;
      }
    }
  </style>
</head>
<body>
  <!-- Солнечные блики -->
  <div class="sunlight" id="sunlight"></div>
  
  <div class="container">
    <!-- Заголовок -->
    <div class="header">
      <h1>SAUBER Weather</h1>
    </div>
    
    <!-- Карта погоды -->
    <div class="weather-map-container">
      <div id="weather-map" class="weather-map"></div>
      <div class="map-controls">
        <button class="map-layer-btn" onclick="changeWeatherLayer('temp_new')">Температура</button>
        <button class="map-layer-btn" onclick="changeWeatherLayer('clouds_new')">Облака</button>
        <button class="map-layer-btn" onclick="changeWeatherLayer('precipitation_new')">Осадки</button>
        <button class="map-layer-btn" onclick="changeWeatherLayer('wind_new')">Ветер</button>
      </div>
    </div>
    
    <!-- Прогноз по дням -->
    <div class="forecast-scroll">
      <div class="forecast-days" id="forecast-days">
        <!-- Прогноз будет загружен здесь -->
      </div>
    </div>
    
    <!-- Текущая погода -->
    <div class="current-weather">
      <div class="weather-param">
        <div class="param-value" id="weather-temp">--°</div>
        <div class="param-label">Температура</div>
      </div>
      <div class="weather-param">
        <div class="param-value" id="weather-wind">-- м/с</div>
        <div class="param-label">Ветер</div>
      </div>
      <div class="weather-param">
        <div class="param-value" id="weather-humidity">--%</div>
        <div class="param-label">Влажность</div>
      </div>
      <div class="weather-param">
        <div class="param-value" id="weather-pressure">-- гПа</div>
        <div class="param-label">Давление</div>
      </div>
    </div>
    
    <!-- Наш датчик -->
    <div class="sensor-data">
      <div class="sensor-param">
        <div class="sensor-value" id="temp">--°</div>
        <div class="sensor-label">Температура</div>
      </div>
      <div class="sensor-param">
        <div class="sensor-value" id="pressure">-- гПа</div>
        <div class="sensor-label">Давление</div>
      </div>
      <div class="sensor-param">
        <div class="sensor-value" id="altitude">-- м</div>
        <div class="sensor-label">Высота</div>
      </div>
    </div>
    
    <!-- Качество воздуха -->
    <div class="air-quality">
      <div class="quality-item">
        <div class="quality-header" onclick="toggleInfo('pm1_0_info')">
          <span>PM1.0: <span id="pm1_0" class="quality-value">--</span> µg/m³</span>
          <i class="fas fa-chevron-down"></i>
        </div>
        <div class="quality-indicator" id="pm1_0_indicator"></div>
        <div class="quality-info" id="pm1_0_info">
          <p><strong>PM1.0</strong> - ультрамелкие частицы диаметром менее 1 микрона.</p>
          <p><i class="fas fa-lungs"></i> <strong>Влияние:</strong> Могут проникать глубоко в лёгкие и даже в кровеносную систему.</p>
        </div>
      </div>
      
      <div class="quality-item">
        <div class="quality-header" onclick="toggleInfo('pm2_5_info')">
          <span>PM2.5: <span id="pm2_5" class="quality-value">--</span> µg/m³</span>
          <i class="fas fa-chevron-down"></i>
        </div>
        <div class="quality-indicator" id="pm2_5_indicator"></div>
        <div class="quality-info" id="pm2_5_info">
          <p><strong>PM2.5</strong> - мелкие частицы диаметром менее 2.5 микрон.</p>
          <p><i class="fas fa-lungs"></i> <strong>Влияние:</strong> Опасны для здоровья, вызывают респираторные заболевания.</p>
          <p><i class="fas fa-clipboard-check"></i> <strong>Нормы:</strong> ВОЗ рекомендует не более 25 µg/m³ в сутки.</p>
        </div>
      </div>
      
      <div class="quality-item">
        <div class="quality-header" onclick="toggleInfo('pm10_info')">
          <span>PM10: <span id="pm10" class="quality-value">--</span> µg/m³</span>
          <i class="fas fa-chevron-down"></i>
        </div>
        <div class="quality-indicator" id="pm10_indicator"></div>
        <div class="quality-info" id="pm10_info">
          <p><strong>PM10</strong> - крупные частицы диаметром менее 10 микрон.</p>
          <p><i class="fas fa-lungs"></i> <strong>Влияние:</strong> Оседают в верхних дыхательных путях.</p>
          <p><i class="fas fa-clipboard-check"></i> <strong>Нормы:</strong> ВОЗ рекомендует не более 50 µg/m³ в сутки.</p>
        </div>
      </div>
    </div>
    
    <!-- Компас -->
    <div class="compass-container">
      <div class="compass">
        <div class="compass-arrow" id="compass-arrow"></div>
        <div class="compass-labels">
          <div class="compass-label" style="top: 5px; left: 50%; transform: translateX(-50%);">N</div>
          <div class="compass-label" style="bottom: 5px; left: 50%; transform: translateX(-50%);">S</div>
          <div class="compass-label" style="top: 50%; left: 5px; transform: translateY(-50%);">W</div>
          <div class="compass-label" style="top: 50%; right: 5px; transform: translateY(-50%);">E</div>
        </div>
      </div>
    </div>
    
    <div id="status" class="status offline">Нет соединения с сервером</div>
  </div>

  <!-- Подключаемые библиотеки -->
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
  
  <script>
    // Конфигурация Firebase
    const firebaseConfig = {
      apiKey: "W5UxNy6wP8sRXfTVWhJK2U3iY6ta4mQRs0AQz8vA",
      authDomain: "sauberweather.firebaseapp.com",
      databaseURL: "https://sauberweather-default-rtdb.firebaseio.com",
      projectId: "sauberweather",
      storageBucket: "sauberweather.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "1:YOUR_APP_ID:web:YOUR_APP_ID"
    };

    // Конфигурация OpenWeatherMap
    const weatherConfig = {
      apiKey: "38a08d0b9ccb65b9efcf357ccb9622eb",
      city: "Chelyabinsk",
      lat: 55.16,
      lon: 61.40,
      units: "metric",
      lang: "ru"
    };

    // Инициализация Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Координаты датчика
    const SENSOR_COORDS = [55.215463, 61.291353];

    // Элементы интерфейса
    const elements = {
      // Погода
      weatherTemp: document.getElementById("weather-temp"),
      weatherWind: document.getElementById("weather-wind"),
      weatherHumidity: document.getElementById("weather-humidity"),
      weatherPressure: document.getElementById("weather-pressure"),
      forecastDays: document.getElementById("forecast-days"),
      
      // Датчик
      temp: document.getElementById("temp"),
      pressure: document.getElementById("pressure"),
      altitude: document.getElementById("altitude"),
      pm1_0: document.getElementById("pm1_0"),
      pm2_5: document.getElementById("pm2_5"),
      pm10: document.getElementById("pm10"),
      pm1_0_indicator: document.getElementById("pm1_0_indicator"),
      pm2_5_indicator: document.getElementById("pm2_5_indicator"),
      pm10_indicator: document.getElementById("pm10_indicator"),
      status: document.getElementById("status"),
      
      // Карты
      weatherMap: null,
      currentWeatherLayer: null,
      
      // Компас
      compassArrow: document.getElementById("compass-arrow"),
      
      // Солнечные блики
      sunlight: document.getElementById("sunlight")
    };

    // ===== СОЛНЕЧНЫЕ БЛИКИ =====
    function handleDeviceOrientation(event) {
      if (!event.beta || !event.gamma) return;
      
      // Обновляем позицию солнечных бликов
      const x = (event.gamma / 90) * 100;
      const y = (event.beta / 90) * 100;
      elements.sunlight.style.transform = `translate(${x}%, ${y}%)`;
    }

    // ===== КОМПАС =====
    function handleCompass(event) {
      if (event.webkitCompassHeading) {
        // Для iOS
        const heading = event.webkitCompassHeading;
        elements.compassArrow.style.transform = `rotate(${360 - heading}deg)`;
      } else if (event.alpha !== null) {
        // Для других устройств
        const alpha = event.alpha;
        elements.compassArrow.style.transform = `rotate(${360 - alpha}deg)`;
      }
    }

    // ===== ФУНКЦИИ ДЛЯ НАШЕГО ДАТЧИКА =====
    function toggleInfo(id) {
      const element = document.getElementById(id);
      element.classList.toggle('active');
      const icon = element.previousElementSibling.querySelector('i');
      icon.classList.toggle('fa-chevron-down');
      icon.classList.toggle('fa-chevron-up');
    }

    function updateAirQualityIndicators(pm1_0, pm2_5, pm10) {
      // Обновляем значения
      elements.pm1_0.textContent = pm1_0 !== undefined ? pm1_0 : "--";
      elements.pm2_5.textContent = pm2_5 !== undefined ? pm2_5 : "--";
      elements.pm10.textContent = pm10 !== undefined ? pm10 : "--";

      // Обновляем индикаторы
      if (pm1_0 !== undefined) {
        elements.pm1_0_indicator.style.width = `${Math.min(pm1_0 / 50 * 100, 100)}%`;
      }
      if (pm2_5 !== undefined) {
        elements.pm2_5_indicator.style.width = `${Math.min(pm2_5 / 50 * 100, 100)}%`;
      }
      if (pm10 !== undefined) {
        elements.pm10_indicator.style.width = `${Math.min(pm10 / 100 * 100, 100)}%`;
      }
    }

    // ===== ФУНКЦИИ ДЛЯ API ПОГОДЫ =====
    async function fetchWeatherData() {
      try {
        // Загрузка текущей погоды и прогноза
        const currentResponse = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?lat=${weatherConfig.lat}&lon=${weatherConfig.lon}&units=${weatherConfig.units}&lang=${weatherConfig.lang}&appid=${weatherConfig.apiKey}`
        );
        
        const forecastResponse = await fetch(
          `https://api.openweathermap.org/data/2.5/forecast?lat=${weatherConfig.lat}&lon=${weatherConfig.lon}&units=${weatherConfig.units}&lang=${weatherConfig.lang}&appid=${weatherConfig.apiKey}&cnt=40`
        );
        
        if (!currentResponse.ok || !forecastResponse.ok) {
          throw new Error('Ошибка получения данных');
        }
        
        const currentData = await currentResponse.json();
        const forecastData = await forecastResponse.json();
        
        // Обновляем UI
        updateCurrentWeather(currentData);
        updateWeatherForecast(forecastData);
        
        // Инициализируем карту погоды (если еще не инициализирована)
        if (!elements.weatherMap) {
          initWeatherMap();
        }
        
      } catch (error) {
        console.error('Ошибка при загрузке данных погоды:', error);
      }
    }

    function updateCurrentWeather(data) {
      elements.weatherTemp.textContent = `${Math.round(data.main.temp)}°`;
      elements.weatherWind.textContent = `${data.wind.speed} м/с`;
      elements.weatherHumidity.textContent = `${data.main.humidity}%`;
      elements.weatherPressure.textContent = `${Math.round(data.main.pressure)} гПа`;
    }

    function updateWeatherForecast(data) {
      // Очищаем контейнер
      elements.forecastDays.innerHTML = '';
      
      // Группируем по дням
      const dailyForecast = {};
      const days = ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'];
      
      data.list.forEach(item => {
        const date = new Date(item.dt * 1000);
        const dayKey = date.toLocaleDateString();
        
        if (!dailyForecast[dayKey]) {
          dailyForecast[dayKey] = {
            date: date,
            temps: []
          };
        }
        
        dailyForecast[dayKey].temps.push(item.main.temp);
      });
      
      // Добавляем прогноз на 5 дней (сегодня + 4 следующих)
      const forecastDays = Object.keys(dailyForecast).slice(0, 5);
      
      forecastDays.forEach((dayKey, index) => {
        const day = dailyForecast[dayKey];
        const dayName = index === 0 ? 'Сегодня' : days[day.date.getDay()];
        
        // Средняя температура за день
        const minTemp = Math.min(...day.temps);
        const maxTemp = Math.max(...day.temps);
        
        // Создаем элемент дня
        const dayElement = document.createElement('div');
        dayElement.className = 'forecast-day';
        dayElement.innerHTML = `
          <div class="forecast-dayname">${dayName}</div>
          <div class="forecast-temp">${Math.round(maxTemp)}°/${Math.round(minTemp)}°</div>
        `;
        
        elements.forecastDays.appendChild(dayElement);
      });
    }

    // ===== КАРТЫ ПОГОДЫ =====
    function initWeatherMap() {
      elements.weatherMap = L.map('weather-map').setView([weatherConfig.lat, weatherConfig.lon], 6);
      
      // Базовая карта
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap'
      }).addTo(elements.weatherMap);
      
      // По умолчанию показываем слой с температурой
      changeWeatherLayer('temp_new');
    }

    function changeWeatherLayer(layerType) {
      // Удаляем предыдущий слой
      if (elements.currentWeatherLayer) {
        elements.weatherMap.removeLayer(elements.currentWeatherLayer);
      }
      
      // Добавляем новый слой
      elements.currentWeatherLayer = L.tileLayer(
        `https://tile.openweathermap.org/map/${layerType}/{z}/{x}/{y}.png?appid=${weatherConfig.apiKey}`, {
          attribution: '© OpenWeatherMap',
          opacity: 0.7
        }
      ).addTo(elements.weatherMap);
    }

    // ===== ОБНОВЛЕНИЕ ДАННЫХ С ДАТЧИКА =====
    function updateSensorData(snapshot) {
      const data = snapshot.val();
      if (data) {
        // Обновляем данные на странице
        elements.temp.textContent = data.temp !== undefined ? 
          `${data.temp.toFixed(1)}°` : "--°";
          
        elements.pressure.textContent = data.pressure !== undefined ? 
          `${data.pressure.toFixed(1)} гПа` : "-- гПа";
          
        elements.altitude.textContent = data.altitude !== undefined ? 
          `${data.altitude.toFixed(1)} м` : "-- м";

        // Обновляем качество воздуха
        updateAirQualityIndicators(data.pm1_0, data.pm2_5, data.pm10);

        // Обновляем статус
        elements.status.textContent = "Данные обновлены: " + new Date().toLocaleTimeString();
        elements.status.className = "status online";
      }
    }

    // ===== ЗАПУСК ПРИЛОЖЕНИЯ =====
    document.addEventListener("DOMContentLoaded", () => {
      // Подписываемся на изменения данных в Firebase
      database.ref('/weather').on('value', updateSensorData, (error) => {
        elements.status.textContent = "Ошибка подключения: " + error.message;
        elements.status.className = "status offline";
      });
      
      // Загружаем данные погоды
      fetchWeatherData();
      
      // Обновляем погоду каждые 30 минут
      setInterval(fetchWeatherData, 30 * 60 * 1000);
      
      // Настраиваем обработчики для гироскопа и компаса
      if (window.DeviceOrientationEvent) {
        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
          // Запрос разрешения для iOS 13+
          DeviceOrientationEvent.requestPermission()
            .then(permissionState => {
              if (permissionState === 'granted') {
                window.addEventListener('deviceorientation', handleDeviceOrientation);
                window.addEventListener('deviceorientationabsolute', handleCompass);
              }
            })
            .catch(console.error);
        } else {
          // Для других браузеров
          window.addEventListener('deviceorientation', function(e) {
            handleDeviceOrientation(e);
            handleCompass(e);
          });
        }
      }
    });
  </script>
</body>
</html>
